#pragma config(Sensor, S1,     lightSensor,    sensorLightActive)
#pragma config(Sensor, S2,     sonarSensor,    sensorSONAR)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/*
-----------------------------------
Team Computing Project CA
Luke Griffin and Connor Heaphy
Started: 04/03/2015
Finished:
-----------------------------------
*/


//prototypes
void move_foward(int line_count);
void sense_object_right(int line_count);
void sense_object_left(int line_count);
void reposition1(void);
void reposition2(void);


task main()
{
	int line_count = 0;
	
	
	while(SensorValue(sonarSensor) > 18)	
	{
		sense_object_right(line_count);
		
		reposition1();
				
		sense_object_left(line_count);
		
		reposition2();
		
		move_foward(line_count);
	}
}//End main()



void move_foward (int line_count)
{
	int num = 0;
	
	if(num == 0)
	{
		while (SensorValue(lightSensor) > 35)
		{
	
			motor[motorB] = 40;
			motor[motorC] = 40;
			
			if (SensorValue(lightSensor) < 35)
			{
				wait1Msec(50);
			
				line_count = line_count + 1;
				
				num = 1;
				
				if (SensorValue(lightSensor) < 35)//stop at black cell
				{
					motor[motorB] = 0;
					motor[motorC] = 0;
			
					line_count = line_count - 1;
			
				}//End if()
						
			}//End if()
			
		}//End while()
		
	}//End if()
	
}//End function move_foward

/*Turns the robot right and 
senses for an object, if the the object is sensed 
it moves towards it, if not it dosent move.
*/
void sense_object_right(int line_count)
{


	nMotorEncoder[motorB] = 0;
	nMotorEncoder[motorC] = 0;

	while(nMotorEncoder[motorC] < 360)//turn right
	{
		motor[motorC] = 40;
		motor[motorB] = 0;
	}//End while()

	motor[motorC]	=	0;

	wait1Msec(50);

	if(SensorValue(sonarSensor) < 60)
	{
		while(SensorValue(sonarSensor) > 18)//if object is found move to
		{
			while (SensorValue(lightSensor) > 35)
			{

				motor[motorB] = 50;
				motor[motorC] = 50;
		
				if (SensorValue(lightSensor) < 35)
				{
					wait1Msec(100);
		
					line_count = line_count + 1;
		
					if (SensorValue(lightSensor) < 35)//stop at black cell
					{
						motor[motorB] = 0;
						motor[motorC] = 0;
		
						line_count = line_count - 1;
		
					}//End if()
					
				}//End if()
		
			}//End while()
			
		}//End while
	}//End if
}//End Function()

/*Repsositions the robot in the 
direction it was facing before 
it sensed for an object
*/
void reposition1()
{
	nMotorEncoder[motorB] = 0;
	nMotorEncoder[motorC] = 0;

	while(nMotorEncoder[motorC] > -360)//turn left
	{
		motor[motorC] = -40;
		motor[motorB] = 0;
	}//End while()

	motor[motorC]	=	0;

	wait1Msec(50);
}

/*Turns the robot left and 
senses for an object, if the the object is sensed 
it moves towards it, if not it dosent move.
*/
void sense_object_left(int line_count)
{


	nMotorEncoder[motorB] = 0;
	nMotorEncoder[motorC] = 0;

	while(nMotorEncoder[motorB] < 360)//turn left
	{
		motor[motorC] = 0;
		motor[motorB] = 40;
	}//End while()

	motor[motorB]	=	0;

	wait1Msec(50);

	if(SensorValue(sonarSensor) < 60)
	{
		while(SensorValue(sonarSensor) > 18)//if object is found move to
		{
			while (SensorValue(lightSensor) > 35)
			{

				motor[motorB] = 50;
				motor[motorC] = 50;
		
				if (SensorValue(lightSensor) < 35)
				{
					wait1Msec(100);
		
					line_count = line_count + 1;
		
					if (SensorValue(lightSensor) < 35)//stop at black cell
					{
						motor[motorB] = 0;
						motor[motorC] = 0;
		
						line_count = line_count - 1;
		
					}//End if()
					
				}//End if()
		
			}//End while()
			
		}//End while
	}//End if
}//End Function()

/*Repsositions the robot in the 
direction it was facing before 
it sensed for an object
*/
void reposition2()
{
	nMotorEncoder[motorB] = 0;
	nMotorEncoder[motorC] = 0;

	while(nMotorEncoder[motorB] > -360)//turn left
	{
		motor[motorC] = 0;
		motor[motorB] = -40;
	}//End while()

	motor[motorB]	=	0;

	wait1Msec(50);
}
